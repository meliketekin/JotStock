"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SentryCli = void 0;
var _ = require("lodash");
var path = require("path");
var SentryCli = /** @class */ (function () {
    function SentryCli(_argv) {
        this._argv = _argv;
        // eslint-disable-next-line @typescript-eslint/typedef
        this._resolve = require.resolve;
    }
    SentryCli.prototype.setResolveFunction = function (resolve) {
        this._resolve = resolve;
    };
    SentryCli.prototype.convertAnswersToProperties = function (answers) {
        var props = {};
        props['defaults/url'] = this._argv.url;
        props['defaults/org'] = _.get(answers, 'config.organization.slug', null);
        props['defaults/project'] = _.get(answers, 'config.project.slug', null);
        props['auth/token'] = _.get(answers, 'config.auth.token', null);
        try {
            var cliPath = this._resolve('@sentry/cli/bin/sentry-cli');
            props['cli/executable'] = path
                .relative(process.cwd(), cliPath)
                .replace(/\\/g, '\\\\');
        }
        catch (e) {
            // we do nothing and leave everyting as it is
        }
        return props;
    };
    /** Create the contents of a `sentry.properties` file */
    SentryCli.prototype.dumpProperties = function (props) {
        var rv = [];
        for (var key in props) {
            // eslint-disable-next-line no-prototype-builtins
            if (props.hasOwnProperty(key)) {
                var value = props[key];
                key = key.replace(/\//g, '.');
                if (value === undefined || value === null) {
                    // comment that property out since it has no value
                    rv.push("#" + key + "=");
                }
                else {
                    rv.push(key + "=" + value);
                }
            }
        }
        // eslint-disable-next-line prefer-template
        return rv.join('\n') + '\n';
    };
    SentryCli.prototype.dumpConfig = function (config) {
        var dumpedSections = [];
        for (var sectionName in config) {
            // eslint-disable-next-line no-prototype-builtins
            if (config.hasOwnProperty(sectionName)) {
                var props = this.dumpProperties(config[sectionName]);
                var section = "[" + sectionName + "]\n" + props;
                dumpedSections.push(section);
            }
        }
        return dumpedSections.join('\n');
    };
    return SentryCli;
}());
exports.SentryCli = SentryCli;
//# sourceMappingURL=SentryCli.js.map