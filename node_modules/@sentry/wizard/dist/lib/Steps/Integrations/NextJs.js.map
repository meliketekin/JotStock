{"version":3,"file":"NextJs.js","sourceRoot":"","sources":["../../../../lib/Steps/Integrations/NextJs.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\nimport * as fs from 'fs';\nimport { Answers, prompt } from 'inquirer';\nimport * as _ from 'lodash';\nimport * as path from 'path';\nimport { satisfies, subset, valid, validRange } from 'semver';\n\nimport { Args } from '../../Constants';\nimport { debug, green, l, nl, red } from '../../Helper/Logging';\nimport { SentryCli, SentryCliProps } from '../../Helper/SentryCli';\nimport { BaseIntegration } from './BaseIntegration';\n\nconst COMPATIBLE_NEXTJS_VERSIONS = '>=10.0.8 <13.0.0';\nconst COMPATIBLE_SDK_VERSIONS = '>=7.3.0';\nconst PROPERTIES_FILENAME = 'sentry.properties';\nconst SENTRYCLIRC_FILENAME = '.sentryclirc';\nconst GITIGNORE_FILENAME = '.gitignore';\nconst CONFIG_DIR = 'configs/';\nconst MERGEABLE_CONFIG_INFIX = 'wizardcopy';\n\n// for those files which can go in more than one place, the list of places they\n// could go (the first one which works will be used)\nconst TEMPLATE_DESTINATIONS: { [key: string]: string[] } = {\n  '_error.js': ['pages', 'src/pages'],\n  'next.config.js': ['.'],\n  'sentry.server.config.js': ['.'],\n  'sentry.client.config.js': ['.'],\n};\n\nlet appPackage: any = {};\n\ntry {\n  appPackage = require(path.join(process.cwd(), 'package.json'));\n} catch {\n  // We don't need to have this\n}\n\nexport class NextJs extends BaseIntegration {\n  protected _sentryCli: SentryCli;\n\n  constructor(protected _argv: Args) {\n    super(_argv);\n    this._sentryCli = new SentryCli(this._argv);\n  }\n\n  public async emit(answers: Answers): Promise<Answers> {\n    const dsn = _.get(answers, ['config', 'dsn', 'public'], null);\n    nl();\n\n    const sentryCliProps = this._sentryCli.convertAnswersToProperties(answers);\n    await this._createSentryCliConfig(sentryCliProps);\n\n    const configDirectory = path.join(\n      __dirname,\n      '..',\n      '..',\n      '..',\n      'NextJs',\n      CONFIG_DIR,\n    );\n\n    if (fs.existsSync(configDirectory)) {\n      this._createNextConfig(configDirectory, dsn);\n    } else {\n      debug(\n        `Couldn't find ${configDirectory}, probably because you ran this from inside of \\`/lib\\` rather than \\`/dist\\``,\n      );\n      nl();\n    }\n\n    l(\n      'For more information, see https://docs.sentry.io/platforms/javascript/guides/nextjs/',\n    );\n    nl();\n\n    return {};\n  }\n\n  public async shouldConfigure(_answers: Answers): Promise<Answers> {\n    if (this._shouldConfigure) {\n      return this._shouldConfigure;\n    }\n\n    nl();\n\n    let userAnswers: Answers = { continue: true };\n    if (\n      (!this._checkPackageVersion('next', COMPATIBLE_NEXTJS_VERSIONS, true) ||\n        !this._checkPackageVersion(\n          '@sentry/nextjs',\n          COMPATIBLE_SDK_VERSIONS,\n          true,\n        )) &&\n      !this._argv.quiet\n    ) {\n      userAnswers = await prompt({\n        message:\n          'There were errors during your project checkup, do you still want to continue?',\n        name: 'continue',\n        default: false,\n        type: 'confirm',\n      });\n    }\n\n    nl();\n\n    if (!userAnswers['continue']) {\n      throw new Error('Please install the required dependencies to continue.');\n    }\n\n    this._shouldConfigure = Promise.resolve({ nextjs: true });\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    return this.shouldConfigure;\n  }\n\n  private async _createSentryCliConfig(\n    cliProps: SentryCliProps,\n  ): Promise<void> {\n    const { 'auth/token': authToken, ...cliPropsToWrite } = cliProps;\n\n    /**\n     * To not commit the auth token to the VCS, instead of adding it to the\n     * properties file (like the rest of props), it's added to the Sentry CLI\n     * config, which is added to the gitignore. This way makes the properties\n     * file safe to commit without exposing any auth tokens.\n     */\n    if (authToken) {\n      try {\n        await fs.promises.appendFile(\n          SENTRYCLIRC_FILENAME,\n          this._sentryCli.dumpConfig({ auth: { token: authToken } }),\n        );\n        green(`✓ Successfully added the auth token to ${SENTRYCLIRC_FILENAME}`);\n      } catch {\n        red(\n          `⚠ Could not add the auth token to ${SENTRYCLIRC_FILENAME}, ` +\n            `please add it to identify your user account:\\n${authToken}`,\n        );\n        nl();\n      }\n    } else {\n      red(\n        `⚠ Did not find an auth token, please add your token to ${SENTRYCLIRC_FILENAME}`,\n      );\n      l(\n        'To generate an auth token, visit https://sentry.io/settings/account/api/auth-tokens/',\n      );\n      l(\n        'To learn how to configure Sentry CLI, visit ' +\n          'https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/#configure-sentry-cli',\n      );\n    }\n\n    await this._addToGitignore(\n      SENTRYCLIRC_FILENAME,\n      `⚠ Could not add ${SENTRYCLIRC_FILENAME} to ${GITIGNORE_FILENAME}, ` +\n        'please add it to not commit your auth key.',\n    );\n\n    try {\n      await fs.promises.writeFile(\n        `./${PROPERTIES_FILENAME}`,\n        this._sentryCli.dumpProperties(cliPropsToWrite),\n      );\n      green(`✓ Successfully created sentry.properties`);\n    } catch {\n      red(`⚠ Could not add org and project data to ${PROPERTIES_FILENAME}`);\n      l(\n        'See docs for a manual setup: https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/#configure-sentry-cli',\n      );\n    }\n    nl();\n  }\n\n  private async _addToGitignore(\n    filepath: string,\n    errorMsg: string,\n  ): Promise<void> {\n    /**\n     * Don't check whether the given file is ignored because:\n     * 1. It's tricky to check it without git.\n     * 2. Git might not be installed or accessible.\n     * 3. It's convenient to use a module to interact with git, but it would\n     *    increase the size x2 approximately. Docs say to run the Wizard without\n     *    installing it, and duplicating the size would slow the set-up down.\n     * 4. The Wizard is meant to be run once.\n     * 5. A message is logged informing users it's been added to the gitignore.\n     * 6. It will be added to the gitignore as many times as it runs - not a big\n     *    deal.\n     * 7. It's straightforward to remove it from the gitignore.\n     */\n    try {\n      await fs.promises.appendFile(\n        GITIGNORE_FILENAME,\n        `\\n# Sentry\\n${filepath}\\n`,\n      );\n      green(`✓ ${filepath} added to ${GITIGNORE_FILENAME}`);\n    } catch {\n      red(errorMsg);\n    }\n  }\n\n  private _createNextConfig(configDirectory: string, dsn: any): void {\n    const templates = fs.readdirSync(configDirectory);\n    for (const template of templates) {\n      this._setTemplate(\n        configDirectory,\n        template,\n        TEMPLATE_DESTINATIONS[template],\n        dsn,\n      );\n    }\n    red(\n      '⚠ Performance monitoring is enabled capturing 100% of transactions.\\n' +\n        '  Learn more in https://docs.sentry.io/product/performance/',\n    );\n    nl();\n  }\n\n  private _setTemplate(\n    configDirectory: string,\n    templateFile: string,\n    destinationOptions: string[],\n    dsn: string,\n  ): void {\n    const templatePath = path.join(configDirectory, templateFile);\n\n    for (const destinationDir of destinationOptions) {\n      if (!fs.existsSync(destinationDir)) {\n        continue;\n      }\n\n      const destinationPath = path.join(destinationDir, templateFile);\n      // in case the file in question already exists, we'll make a copy with\n      // `MERGEABLE_CONFIG_INFIX` inserted just before the extension, so as not\n      // to overwrite the existing file\n      const mergeableFilePath = path.join(\n        destinationDir,\n        this._spliceInPlace(\n          templateFile.split('.'),\n          -1,\n          0,\n          MERGEABLE_CONFIG_INFIX,\n        ).join('.'),\n      );\n\n      if (!fs.existsSync(destinationPath)) {\n        this._fillAndCopyTemplate(templatePath, destinationPath, dsn);\n      } else if (!fs.existsSync(mergeableFilePath)) {\n        this._fillAndCopyTemplate(templatePath, mergeableFilePath, dsn);\n        red(\n          `File \\`${templateFile}\\` already exists, so created \\`${mergeableFilePath}\\`.\\n` +\n            'Please merge those files.',\n        );\n        nl();\n      } else {\n        red(\n          `Both \\`${templateFile}\\` and \\`${mergeableFilePath}\\` already exist.\\n` +\n            'Please merge those files.',\n        );\n        nl();\n      }\n      return;\n    }\n\n    red(\n      `Could not find appropriate destination for \\`${templateFile}\\`. Tried: ${destinationOptions}.`,\n    );\n    nl();\n  }\n\n  private _fillAndCopyTemplate(\n    sourcePath: string,\n    targetPath: string,\n    dsn: string,\n  ): void {\n    const templateContent = fs.readFileSync(sourcePath).toString();\n    const filledTemplate = templateContent.replace('___DSN___', dsn);\n    fs.writeFileSync(targetPath, filledTemplate);\n  }\n\n  private _checkPackageVersion(\n    packageName: string,\n    acceptableVersions: string,\n    canBeLatest: boolean,\n  ): boolean {\n    const depsVersion = _.get(appPackage, ['dependencies', packageName]);\n    const devDepsVersion = _.get(appPackage, ['devDependencies', packageName]);\n\n    if (!depsVersion && !devDepsVersion) {\n      red(`✗ ${packageName} isn't in your dependencies.`);\n      red('  Please install it with yarn/npm.');\n      return false;\n    } else if (\n      !this._fulfillsVersionRange(\n        depsVersion,\n        acceptableVersions,\n        canBeLatest,\n      ) &&\n      !this._fulfillsVersionRange(\n        devDepsVersion,\n        acceptableVersions,\n        canBeLatest,\n      )\n    ) {\n      red(\n        `✗ Your \\`package.json\\` specifies a version of \\`${packageName}\\` outside of the compatible version range ${acceptableVersions}.\\n`,\n      );\n      return false;\n    } else {\n      green(\n        `✓ A compatible version of \\`${packageName}\\` is specified in \\`package.json\\`.`,\n      );\n      return true;\n    }\n  }\n\n  private _fulfillsVersionRange(\n    version: string,\n    acceptableVersions: string,\n    canBeLatest: boolean,\n  ): boolean {\n    if (version === 'latest') {\n      return canBeLatest;\n    }\n\n    let cleanedUserVersion, isRange;\n\n    if (valid(version)) {\n      cleanedUserVersion = valid(version);\n      isRange = false;\n    } else if (validRange(version)) {\n      cleanedUserVersion = validRange(version);\n      isRange = true;\n    }\n\n    return (\n      // If the given version is a bogus format, this will still be undefined and we'll automatically reject it\n      !!cleanedUserVersion &&\n      (isRange\n        ? subset(cleanedUserVersion, acceptableVersions)\n        : satisfies(cleanedUserVersion, acceptableVersions))\n    );\n  }\n\n  private _spliceInPlace(\n    arr: Array<any>,\n    start: number,\n    deleteCount: number,\n    ...inserts: any[]\n  ): Array<any> {\n    arr.splice(start, deleteCount, ...inserts);\n    return arr;\n  }\n}\n"]}