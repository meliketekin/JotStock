{"version":3,"file":"wrapper.js","sourceRoot":"","sources":["../../src/js/wrapper.ts"],"names":[],"mappings":";AAAA,8BAA8B;AAC9B,OAAO,EAKL,QAAQ,GAET,MAAM,eAAe,CAAC;AACvB,OAAO,EAAE,MAAM,EAAE,WAAW,EAAE,MAAM,eAAe,CAAC;AACpD,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AAWvD,MAAM,QAAQ,GAAG,aAAa,CAAC,QAAgD,CAAC;AA0ChF;;GAEG;AACH,MAAM,CAAC,MAAM,MAAM,GAAwB;IACzC;;;OAGG;IACG,SAAS,CAAC,MAAa;;;YAC3B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,OAAO;oBACL,MAAM,EAAE,iDAAiD;oBACzD,MAAM,EAAE,SAAS;iBAClB,CAAC;aACH;YAED,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;YAE1C,6DAA6D;YAC7D,OAAO,KAAK,CAAC,qBAAqB,CAAC;YAEnC,MAAM,MAAM,GAAG;gBACb,QAAQ,EAAE,KAAK,CAAC,QAAQ;gBACxB,GAAG,EAAE,KAAK,CAAC,GAAG;aACf,CAAC;YAEF,IAAI,eAAe,GAAG,KAAK,CAAC;YAC5B,IAAI,MAAM,CAAC,QAAQ,KAAK,SAAS,EAAE;gBACjC,UAAU;gBAEV,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;gBAE5C;;;;;;;kBAOE;gBACF,IAAI,yBAAA,KAAK,CAAC,SAAS,0CAAE,MAAM,0CAAG,CAAC,2CAAG,SAAS,0CAAE,OAAO,KAAI,KAAK,IAAI,KAAK,CAAC,WAAW,EAAE;oBAClF,KAAK,CAAC,WAAW,GAAG,EAAE,CAAC;iBACxB;gBAED,MAAM,OAAO,mCACR,KAAK,KACR,OAAO,EAAE;wBACP,OAAO,EAAE,KAAK,CAAC,OAAO;qBACvB,GACF,CAAC;gBAEF,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;gBAC9C,IAAI,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;gBAClC,IAAI;oBACF,MAAM,GAAG,MAAM,QAAQ,CAAC,oBAAoB,CAAC,aAAa,CAAC,CAAC;iBAC7D;gBAAC,WAAM;oBACN,8EAA8E;iBAC/E;gBAED,MAAM,IAAI,GAAG;oBACX,YAAY,EAAE,kBAAkB;oBAChC,MAAM;oBACN,IAAI,QAAE,OAAO,CAAC,IAAI,mCAAI,OAAO;iBAC9B,CAAC;gBAEF,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBAExC,MAAM,cAAc,GAAG,GAAG,YAAY,KAAK,UAAU,KAAK,aAAa,EAAE,CAAC;gBAE1E,eAAe,GAAG,MAAM,QAAQ,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;aAClE;iBAAM;gBACL,UAAU;gBAEV,MAAM,OAAO,mCACR,KAAK,KACR,OAAO,EAAE;wBACP,OAAO,EAAE,KAAK,CAAC,OAAO;qBACvB,GACF,CAAC;gBAEF,qFAAqF;gBACrF,MAAM,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;gBAE9D,iGAAiG;gBACjG,sEAAsE;gBACtE,eAAe,GAAG,MAAM,QAAQ,CAAC,eAAe,CAAC;oBAC/C,MAAM;oBACN,OAAO,EAAE,iBAAiB;iBAC3B,CAAC,CAAC;aACJ;YAED,IAAI,eAAe,EAAE;gBACnB,OAAO;oBACL,MAAM,EAAE,SAAS;iBAClB,CAAC;aACH;YAED,OAAO;gBACL,MAAM,EAAE,QAAQ;aACjB,CAAC;;KACH;IAED;;;OAGG;IACG,aAAa,CAAC,eAAmC;;YACrD,MAAM,OAAO,mBACX,YAAY,EAAE,IAAI,EAClB,uBAAuB,EAAE,IAAI,IAC1B,eAAe,CACnB,CAAC;YAEF,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE;gBACzB,IAAI,OAAO,CAAC,kBAAkB,EAAE;oBAC9B,MAAM,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;iBACrD;gBACD,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;gBAC1B,OAAO,KAAK,CAAC;aACd;YACD,IAAI,CAAC,OAAO,CAAC,uBAAuB,EAAE;gBACpC,IAAI,OAAO,CAAC,kBAAkB,EAAE;oBAC9B,MAAM,CAAC,IAAI,CACT,iMAAiM,CAClM,CAAC;iBACH;gBACD,OAAO,KAAK,CAAC;aACd;YAED,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE;gBAChB,MAAM,CAAC,IAAI,CACT,wGAAwG,CACzG,CAAC;gBACF,OAAO,KAAK,CAAC;aACd;YAED,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,sDAAsD;YACtD,wFAAwF;YACxF,MAAM,EACJ,UAAU,EACV,gBAAgB,EAChB,YAAY,EACZ,mBAAmB,EACnB,SAAS,KAEP,OAAO,EADN,eAAe,UAChB,OAAO,EAPL,sFAOL,CAAU,CAAC;YACZ,uFAAuF;YAEvF,MAAM,aAAa,GAAG,MAAM,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;YAEpE,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;YAEnC,OAAO,aAAa,CAAC;QACvB,CAAC;KAAA;IAED;;OAEG;IACG,kBAAkB;;YACtB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,MAAM,IAAI,CAAC,oBAAoB,CAAC;aACjC;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,OAAO,QAAQ,CAAC,kBAAkB,EAAE,CAAC;QACvC,CAAC;KAAA;IAED;;;OAGG;IACG,kBAAkB;;YACtB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,MAAM,IAAI,CAAC,oBAAoB,CAAC;aACjC;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE;gBAC3B,OAAO,IAAI,CAAC;aACb;YAED,OAAO,QAAQ,CAAC,kBAAkB,EAAE,CAAC;QACvC,CAAC;KAAA;IAED;;OAEG;IACG,yBAAyB;;YAC7B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,MAAM,IAAI,CAAC,oBAAoB,CAAC;aACjC;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE;gBAC3B,wDAAwD;gBACxD,OAAO,EAAE,CAAC;aACX;YAED,OAAO,QAAQ,CAAC,yBAAyB,EAAE,CAAC;QAC9C,CAAC;KAAA;IAEK,mBAAmB;;YACvB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,MAAM,IAAI,CAAC,oBAAoB,CAAC;aACjC;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,OAAO,QAAQ,CAAC,mBAAmB,EAAE,CAAC;QACxC,CAAC;KAAA;IAEK,iBAAiB;;YACrB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,MAAM,IAAI,CAAC,oBAAoB,CAAC;aACjC;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;aAC/B;YAED,OAAO,QAAQ,CAAC,iBAAiB,EAAE,CAAC;QACtC,CAAC;KAAA;IAED;;;OAGG;IACH,WAAW;QACT,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,QAAQ,CAAC,KAAK,EAAE,CAAC;IACnB,CAAC;IAED;;;OAGG;IACH,OAAO,CAAC,IAAiB;QACvB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,mDAAmD;QACnD,IAAI,eAAe,GAAG,IAAI,CAAC;QAC3B,IAAI,aAAa,GAAG,IAAI,CAAC;QACzB,IAAI,IAAI,EAAE;YACR,MAAM,EAAE,EAAE,EAAE,UAAU,EAAE,KAAK,EAAE,QAAQ,KAAmB,IAAI,EAAlB,SAAS,UAAK,IAAI,EAAxD,yCAAiD,CAAO,CAAC;YAC/D,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC;gBACtC,KAAK;gBACL,EAAE;gBACF,UAAU;gBACV,QAAQ;aACT,CAAC,CAAC;YACH,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;SAClD;QAED,QAAQ,CAAC,OAAO,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;IACnD,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,GAAW,EAAE,KAAa;QAC/B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,MAAM,gBAAgB,GACpB,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAE5D,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IACzC,CAAC;IAED;;;;;OAKG;IACH,QAAQ,CAAC,GAAW,EAAE,KAAc;QAClC,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,0DAA0D;QAC1D,MAAM,gBAAgB,GACpB,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAE5D,QAAQ,CAAC,QAAQ,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IAC3C,CAAC;IAED;;;OAGG;IACH,aAAa,CAAC,UAAsB;QAClC,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,QAAQ,CAAC,aAAa,iCACjB,UAAU;YACb,wCAAwC;YACxC,KAAK,EAAE,UAAU,CAAC,KAAK;gBACrB,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC;gBACtC,CAAC,CAAC,SAAS,EACb,IAAI,EAAE,UAAU,CAAC,IAAI;gBACnB,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,IAAI,CAAC;gBACxC,CAAC,CAAC,SAAS,IACb,CAAC;IACL,CAAC;IAED;;OAEG;IACH,gBAAgB;QACd,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,QAAQ,CAAC,gBAAgB,EAAE,CAAC;IAC9B,CAAC;IAED;;;;OAIG;IACH,UAAU,CAAC,GAAW,EAAE,OAA0C;QAChE,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,MAAM,IAAI,CAAC,kBAAkB,CAAC;SAC/B;QAED,QAAQ,CAAC,UAAU,CACjB,GAAG,EACH,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CACzD,CAAC;IACJ,CAAC;IAED;;OAEG;IACG,cAAc;;YAClB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,OAAO;aACR;YACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;gBACnC,OAAO;aACR;YAED,OAAO,QAAQ,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE;gBACzC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC5B,CAAC,CAAC,CAAC;QACL,CAAC;KAAA;IAED,2BAA2B;QACzB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE;YACnC,OAAO;SACR;QAED,QAAQ,CAAC,2BAA2B,EAAE,CAAC;IACzC,CAAC;IAED,0BAA0B;QACxB,OAAO,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;IAC7D,CAAC;IAED;;;;OAIG;IACH,gBAAgB,CAAC,IAEhB;QACC,MAAM,UAAU,GAA8B,EAAE,CAAC;QAEjD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;YACpC,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;YAC5B,UAAU,CAAC,OAAO,CAAC;gBACjB,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAC9D,CAAC,CAAC,CAAC;QAEH,OAAO,UAAU,CAAC;IACpB,CAAC;IAED;;;;OAIG;IACH,cAAc,CAAC,KAAY;;QACzB,MAAM,SAAS,mCACV,KAAK,KACR,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,EAChE,WAAW,QAAE,KAAK,CAAC,WAAW,0CAAE,GAAG,CAAC,CAAC,UAAU,EAAE,EAAE,CAAC,iCAC/C,UAAU,KACb,KAAK,EAAE,UAAU,CAAC,KAAK;oBACrB,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC;oBACtC,CAAC,CAAC,SAAS,IACb,IACH,CAAC;QAEF,OAAO,SAAS,CAAC;IACnB,CAAC;IAED;;;;OAIG;IACH,aAAa,CAAC,KAAe;QAC3B,IAAI,KAAK,KAAK,QAAQ,CAAC,QAAQ,EAAE;YAC/B,OAAO,QAAQ,CAAC,KAAK,CAAC;SACvB;QACD,IAAI,KAAK,KAAK,QAAQ,CAAC,GAAG,EAAE;YAC1B,OAAO,QAAQ,CAAC,KAAK,CAAC;SACvB;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;OAEG;IACH,eAAe,CACb,MAA4C;QAE5C,OAAO,CAAC,CAAC,MAAM,CAAC;IAClB,CAAC;IAED,oBAAoB,EAAE,IAAI,WAAW,CAAC,oBAAoB,CAAC;IAE3D,kBAAkB,EAAE,IAAI,WAAW,CACjC,wDAAwD,CACzD;IAED,YAAY,EAAE,IAAI;IAClB,aAAa,EAAE,KAAK;IACpB,QAAQ,EAAE,QAAQ,CAAC,EAAE;CACtB,CAAC","sourcesContent":["/* eslint-disable max-lines */\nimport {\n  Breadcrumb,\n  Event,\n  Package,\n  Response,\n  Severity,\n  User,\n} from '@sentry/types';\nimport { logger, SentryError } from '@sentry/utils';\nimport { NativeModules, Platform } from 'react-native';\n\nimport {\n  NativeAppStartResponse,\n  NativeDeviceContextsResponse,\n  NativeFramesResponse,\n  NativeReleaseResponse,\n  SentryNativeBridgeModule,\n} from './definitions';\nimport { ReactNativeOptions } from './options';\n\nconst RNSentry = NativeModules.RNSentry as SentryNativeBridgeModule | undefined;\n\ninterface SentryNativeWrapper {\n  enableNative: boolean;\n  nativeIsReady: boolean;\n  platform: typeof Platform.OS;\n\n  _NativeClientError: Error;\n  _DisabledNativeError: Error;\n\n  _processLevels(event: Event): Event;\n  _processLevel(level: Severity): Severity;\n  _serializeObject(data: { [key: string]: unknown }): { [key: string]: string };\n  _isModuleLoaded(\n    module: SentryNativeBridgeModule | undefined\n  ): module is SentryNativeBridgeModule;\n\n  isNativeTransportAvailable(): boolean;\n\n  initNativeSdk(options: ReactNativeOptions): PromiseLike<boolean>;\n  closeNativeSdk(): PromiseLike<void>;\n\n  sendEvent(event: Event): PromiseLike<Response>;\n\n  fetchNativeRelease(): PromiseLike<NativeReleaseResponse>;\n  fetchNativeDeviceContexts(): PromiseLike<NativeDeviceContextsResponse>;\n  fetchNativeAppStart(): PromiseLike<NativeAppStartResponse | null>;\n  fetchNativeFrames(): PromiseLike<NativeFramesResponse | null>;\n  fetchNativeSdkInfo(): PromiseLike<Package | null>;\n\n  disableNativeFramesTracking(): void;\n\n  addBreadcrumb(breadcrumb: Breadcrumb): void;\n  setContext(key: string, context: { [key: string]: unknown } | null): void;\n  clearBreadcrumbs(): void;\n  setExtra(key: string, extra: unknown): void;\n  setUser(user: User | null): void;\n  setTag(key: string, value: string): void;\n\n  nativeCrash(): void;\n}\n\n/**\n * Our internal interface for calling native functions\n */\nexport const NATIVE: SentryNativeWrapper = {\n  /**\n   * Sending the event over the bridge to native\n   * @param event Event\n   */\n  async sendEvent(_event: Event): Promise<Response> {\n    if (!this.enableNative) {\n      return {\n        reason: 'Event was skipped as native SDK is not enabled.',\n        status: 'skipped',\n      };\n    }\n\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    const event = this._processLevels(_event);\n\n    // Delete this metadata as this should not be sent to Sentry.\n    delete event.sdkProcessingMetadata;\n\n    const header = {\n      event_id: event.event_id,\n      sdk: event.sdk,\n    };\n\n    let envelopeWasSent = false;\n    if (NATIVE.platform === 'android') {\n      // Android\n\n      const headerString = JSON.stringify(header);\n\n      /*\n        We do this to avoid duplicate breadcrumbs on Android as sentry-android applies the breadcrumbs\n        from the native scope onto every envelope sent through it. This scope will contain the breadcrumbs\n        sent through the scope sync feature. This causes duplicate breadcrumbs.\n        We then remove the breadcrumbs in all cases but if it is handled == false,\n        this is a signal that the app would crash and android would lose the breadcrumbs by the time the app is restarted to read\n        the envelope.\n      */\n      if (event.exception?.values?.[0]?.mechanism?.handled != false && event.breadcrumbs) {\n        event.breadcrumbs = [];\n      }\n\n      const payload = {\n        ...event,\n        message: {\n          message: event.message,\n        },\n      };\n\n      const payloadString = JSON.stringify(payload);\n      let length = payloadString.length;\n      try {\n        length = await RNSentry.getStringBytesLength(payloadString);\n      } catch {\n        // The native call failed, we do nothing, we have payload.length as a fallback\n      }\n\n      const item = {\n        content_type: 'application/json',\n        length,\n        type: payload.type ?? 'event',\n      };\n\n      const itemString = JSON.stringify(item);\n\n      const envelopeString = `${headerString}\\n${itemString}\\n${payloadString}`;\n\n      envelopeWasSent = await RNSentry.captureEnvelope(envelopeString);\n    } else {\n      // iOS/Mac\n\n      const payload = {\n        ...event,\n        message: {\n          message: event.message,\n        },\n      };\n\n      // Serialize and remove any instances that will crash the native bridge such as Spans\n      const serializedPayload = JSON.parse(JSON.stringify(payload));\n\n      // The envelope item is created (and its length determined) on the iOS side of the native bridge.\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      envelopeWasSent = await RNSentry.captureEnvelope({\n        header,\n        payload: serializedPayload,\n      });\n    }\n\n    if (envelopeWasSent) {\n      return {\n        status: 'success',\n      };\n    }\n\n    return {\n      status: 'failed',\n    };\n  },\n\n  /**\n   * Starts native with the provided options.\n   * @param options ReactNativeOptions\n   */\n  async initNativeSdk(originalOptions: ReactNativeOptions): Promise<boolean> {\n    const options = {\n      enableNative: true,\n      autoInitializeNativeSdk: true,\n      ...originalOptions,\n    };\n\n    if (!options.enableNative) {\n      if (options.enableNativeNagger) {\n        logger.warn('Note: Native Sentry SDK is disabled.');\n      }\n      this.enableNative = false;\n      return false;\n    }\n    if (!options.autoInitializeNativeSdk) {\n      if (options.enableNativeNagger) {\n        logger.warn(\n          'Note: Native Sentry SDK was not initialized automatically, you will need to initialize it manually. If you wish to disable the native SDK and get rid of this warning, pass enableNative: false'\n        );\n      }\n      return false;\n    }\n\n    if (!options.dsn) {\n      logger.warn(\n        'Warning: No DSN was provided. The Sentry SDK will be disabled. Native SDK will also not be initalized.'\n      );\n      return false;\n    }\n\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    // filter out all the options that would crash native.\n    /* eslint-disable @typescript-eslint/unbound-method,@typescript-eslint/no-unused-vars */\n    const {\n      beforeSend,\n      beforeBreadcrumb,\n      integrations,\n      defaultIntegrations,\n      transport,\n      ...filteredOptions\n    } = options;\n    /* eslint-enable @typescript-eslint/unbound-method,@typescript-eslint/no-unused-vars */\n\n    const nativeIsReady = await RNSentry.initNativeSdk(filteredOptions);\n\n    this.nativeIsReady = nativeIsReady;\n\n    return nativeIsReady;\n  },\n\n  /**\n   * Fetches the release from native\n   */\n  async fetchNativeRelease(): Promise<NativeReleaseResponse> {\n    if (!this.enableNative) {\n      throw this._DisabledNativeError;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    return RNSentry.fetchNativeRelease();\n  },\n\n  /**\n   * Fetches the Sdk info for the native sdk.\n   * NOTE: Only available on iOS.\n   */\n  async fetchNativeSdkInfo(): Promise<Package | null> {\n    if (!this.enableNative) {\n      throw this._DisabledNativeError;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    if (this.platform !== 'ios') {\n      return null;\n    }\n\n    return RNSentry.fetchNativeSdkInfo();\n  },\n\n  /**\n   * Fetches the device contexts. Not used on Android.\n   */\n  async fetchNativeDeviceContexts(): Promise<NativeDeviceContextsResponse> {\n    if (!this.enableNative) {\n      throw this._DisabledNativeError;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    if (this.platform !== 'ios') {\n      // Only ios uses deviceContexts, return an empty object.\n      return {};\n    }\n\n    return RNSentry.fetchNativeDeviceContexts();\n  },\n\n  async fetchNativeAppStart(): Promise<NativeAppStartResponse | null> {\n    if (!this.enableNative) {\n      throw this._DisabledNativeError;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    return RNSentry.fetchNativeAppStart();\n  },\n\n  async fetchNativeFrames(): Promise<NativeFramesResponse | null> {\n    if (!this.enableNative) {\n      throw this._DisabledNativeError;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    return RNSentry.fetchNativeFrames();\n  },\n\n  /**\n   * Triggers a native crash.\n   * Use this only for testing purposes.\n   */\n  nativeCrash(): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    RNSentry.crash();\n  },\n\n  /**\n   * Sets the user in the native scope.\n   * Passing null clears the user.\n   */\n  setUser(user: User | null): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    // separate and serialze all non-default user keys.\n    let defaultUserKeys = null;\n    let otherUserKeys = null;\n    if (user) {\n      const { id, ip_address, email, username, ...otherKeys } = user;\n      defaultUserKeys = this._serializeObject({\n        email,\n        id,\n        ip_address,\n        username,\n      });\n      otherUserKeys = this._serializeObject(otherKeys);\n    }\n\n    RNSentry.setUser(defaultUserKeys, otherUserKeys);\n  },\n\n  /**\n   * Sets a tag in the native module.\n   * @param key string\n   * @param value string\n   */\n  setTag(key: string, value: string): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    const stringifiedValue =\n      typeof value === 'string' ? value : JSON.stringify(value);\n\n    RNSentry.setTag(key, stringifiedValue);\n  },\n\n  /**\n   * Sets an extra in the native scope, will stringify\n   * extra value if it isn't already a string.\n   * @param key string\n   * @param extra any\n   */\n  setExtra(key: string, extra: unknown): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    // we stringify the extra as native only takes in strings.\n    const stringifiedExtra =\n      typeof extra === 'string' ? extra : JSON.stringify(extra);\n\n    RNSentry.setExtra(key, stringifiedExtra);\n  },\n\n  /**\n   * Adds breadcrumb to the native scope.\n   * @param breadcrumb Breadcrumb\n   */\n  addBreadcrumb(breadcrumb: Breadcrumb): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    RNSentry.addBreadcrumb({\n      ...breadcrumb,\n      // Process and convert deprecated levels\n      level: breadcrumb.level\n        ? this._processLevel(breadcrumb.level)\n        : undefined,\n      data: breadcrumb.data\n        ? this._serializeObject(breadcrumb.data)\n        : undefined,\n    });\n  },\n\n  /**\n   * Clears breadcrumbs on the native scope.\n   */\n  clearBreadcrumbs(): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    RNSentry.clearBreadcrumbs();\n  },\n\n  /**\n   * Sets context on the native scope. Not implemented in Android yet.\n   * @param key string\n   * @param context key-value map\n   */\n  setContext(key: string, context: { [key: string]: unknown } | null): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      throw this._NativeClientError;\n    }\n\n    RNSentry.setContext(\n      key,\n      context !== null ? this._serializeObject(context) : null\n    );\n  },\n\n  /**\n   * Closes the Native Layer SDK\n   */\n  async closeNativeSdk(): Promise<void> {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      return;\n    }\n\n    return RNSentry.closeNativeSdk().then(() => {\n      this.enableNative = false;\n    });\n  },\n\n  disableNativeFramesTracking(): void {\n    if (!this.enableNative) {\n      return;\n    }\n    if (!this._isModuleLoaded(RNSentry)) {\n      return;\n    }\n\n    RNSentry.disableNativeFramesTracking();\n  },\n\n  isNativeTransportAvailable(): boolean {\n    return this.enableNative && this._isModuleLoaded(RNSentry);\n  },\n\n  /**\n   * Serializes all values of root-level keys into strings.\n   * @param data key-value map.\n   * @returns An object where all root-level values are strings.\n   */\n  _serializeObject(data: {\n    [key: string]: unknown;\n  }): { [key: string]: string } {\n    const serialized: { [key: string]: string } = {};\n\n    Object.keys(data).forEach((dataKey) => {\n      const value = data[dataKey];\n      serialized[dataKey] =\n        typeof value === 'string' ? value : JSON.stringify(value);\n    });\n\n    return serialized;\n  },\n\n  /**\n   * Convert js severity level in event.level and event.breadcrumbs to more widely supported levels.\n   * @param event\n   * @returns Event with more widely supported Severity level strings\n   */\n  _processLevels(event: Event): Event {\n    const processed: Event = {\n      ...event,\n      level: event.level ? this._processLevel(event.level) : undefined,\n      breadcrumbs: event.breadcrumbs?.map((breadcrumb) => ({\n        ...breadcrumb,\n        level: breadcrumb.level\n          ? this._processLevel(breadcrumb.level)\n          : undefined,\n      })),\n    };\n\n    return processed;\n  },\n\n  /**\n   * Convert js severity level which has critical and log to more widely supported levels.\n   * @param level\n   * @returns More widely supported Severity level strings\n   */\n  _processLevel(level: Severity): Severity {\n    if (level === Severity.Critical) {\n      return Severity.Fatal;\n    }\n    if (level === Severity.Log) {\n      return Severity.Debug;\n    }\n\n    return level;\n  },\n\n  /**\n   * Checks whether the RNSentry module is loaded.\n   */\n  _isModuleLoaded(\n    module: SentryNativeBridgeModule | undefined\n  ): module is SentryNativeBridgeModule {\n    return !!module;\n  },\n\n  _DisabledNativeError: new SentryError('Native is disabled'),\n\n  _NativeClientError: new SentryError(\n    \"Native Client is not available, can't start on native.\"\n  ),\n\n  enableNative: true,\n  nativeIsReady: false,\n  platform: Platform.OS,\n};\n"]}